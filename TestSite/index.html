<!DOCTYPE html>
<html>
<head>
<title>Josh's Site</title>
  <link rel="stylesheet" href="./jquery/demos/css/themes/default/jquery.mobile-1.4.5.min.css">
<script src="./jquery/jquery.js"></script>
<script src="./jquery/jquery.mobile-1.4.5.min.js"></script>

  <script>
$('#page1').on('pagecreate', function() {

    $('a').bind('click', function(e) {
    var trans = $(this).text() || 'none',
        rev = !!$('#cb1').attr('checked');

    $.mobile.changePage('#page1', { transition: trans,
                                    allowSamePageTransition: true,
                                    reverse: rev } );
    $('#p1').text( 'last transition: ' + trans + ' - reverse: ' + rev );
  });
});

$('#page1').bind('pagehide', function(e) {
  $('a.ui-btn').removeClass('ui-btn-active');
  if ( !!$('#cb2').attr('checked') && !$(this).hasClass('ui-btn-active') ) { 
    $(this).addClass('ui-page-active');
  }
});    

</script>
<style>
@media all and (max-width: 30em) {
	.my-breakpoint .ui-block-a { 
		width: 50%; 
		float:left; 
	}
	
	.my-breakpoint .ui-block-a2 { 
		width: 50%; 
		float:left; 
	}
	.my-breakpoint .ui-block-b { 
		width: 100%; 
		float:left; 
	}
	.my-breakpoint .ui-block-c { 
		width: 50%; 
		float:left; 
	}
	.my-breakpoint .ui-block-d,
	.my-breakpoint .ui-block-e { 
		width: 100%; 
		float:none; 
	}
}

@media all and (min-width: 30em) {
	.my-breakpoint.ui-grid-b .ui-block-a { width: 50%; float: left;}
	.my-breakpoint.ui-grid-b .ui-block-a2 { width: 50%; float: left;}
	.my-breakpoint.ui-grid-b .ui-block-b { width: 33.33%; } 
	.my-breakpoint.ui-grid-b .ui-block-c { width: 33.33%; }
	.my-breakpoint.ui-grid-b .ui-block-d { width: 50%; }
	.my-breakpoint.ui-grid-b .ui-block-a { clear: left; }
	}
}
</style>

</head>
<body>

<div role="main" class="ui-content ui-responsive" style='margin:50px; position:relative'>
     <!--a data-role="button" href="page2.html">Go to page 2</a-->
	 <div class="ui-grid-b my-breakpoint">
	  
	  <div class="ui-corner-all custom-corners ui-block-b" id="wonDiv">
	  <div class="ui-bar ui-bar-a">
		<h3>Games Won <br /> (in a row)</h3>
	  </div>
	  <div class="ui-body ui-body-a">
		<p id="won">0</p>
	  </div>
	</div>
	
	<div class="ui-corner-all custom-corners ui-block-c" id="wonDiv">
	  <div class="ui-bar ui-bar-a">
		<h3>Game <br /> Timer</h3>
	  </div>
	  <div class="ui-body ui-body-a">
		<p id="timer">0</p>
	  </div>
	</div>
	
	<div class="ui-corner-all custom-corners ui-block-c" id="wonDiv">
	  <div class="ui-bar ui-bar-a">
		<h3>Game <br />Score</h3>
	  </div>
	  <div class="ui-body ui-body-a">
		<p id="score">0</p>
	  </div>
	</div>
	
	<div class="ui-corner-all custom-corners ui-block-a">
	  <div class="ui-bar ui-bar-a">
		<h3>Wanted <br /> Value</h3>
	  </div>
	  <div class="ui-body ui-body-a">
		<p id="goal">Content</p>
	  </div>
	</div>
	 <div class="ui-corner-all custom-corners ui-block-a2">
	  <div class="ui-bar ui-bar-a">
		<h3>Current <br /> Value</h3>
	  </div>
	  <div class="ui-body ui-body-a">
		<p id="currentVal">Content</p>
	  </div>
	</div>
	  
	
	
	</div>
	<p id="displaySuccess">
	 </p>
	 <div id="slider1">
	<label for="slider-fill">Slider with fill and step of 7:</label>
	<input name="slider-fill" id="slider-fill1" type="range" min="0" max="98" step="7" value="0" data-highlight="true" onchange="update()">
	</div>
	 <div id="slider2">
	<label for="slider-fill">Slider with fill and step of 11:</label>
	<input name="slider-fill" id="slider-fill2" type="range" min="0" max="99" step="11" value="0" data-highlight="true" onchange="update()">
</div>
	 <div id="slider3">
	<label for="slider-fill">Slider with fill and step of -15:</label>
	<input name="slider-fill" id="slider-fill3" type="range" min="-90" max="0" step="15" value="0" data-highlight="true" onchange="update()">
</div>
	 <div id="slider4">
	<label for="slider-fill">Slider with fill and step of -33:</label>
	<input name="slider-fill" id="slider-fill4" type="range" min="-99" max="0" step="33" value="0" data-highlight="true" onchange="update()">
</div>
	<p>
	 </p>
	<div class="ui-grid-b my-breakpoint">
	<div class="ui-block-d">
	<a data-role="button" onclick="newGame()">New Game</a>
	</div>
	
	<div class="ui-block-d">
	<a data-role="button" href="#preferencePanel">Preferences</a>
	</div>
	
	
	</div>
	

</div>


<div data-role="panel" id="preferencePanel" data-position="right" data-display="overlay">
<h1>Preferences:</h1>
<h3>Warning: Changing these options will restart the game!</h3>
<form>
	<label for="playWith4Sliders">Play with all 4 sliders:</label>
	<select id="playWith4Sliders" name="playWith4Sliders" data-role="slider">
		<option value="true">True</option>
		<option value="false">False</option>
	</select>
</form>
<form>
	<label for="forceOdds">Force 2nd and 3rd Sliders to be odd:</label>
	<select id="forceOdds" name="forceOdds" data-role="slider">
		<option value="true">True</option>
		<option value="false">False</option>
	</select>
</form>
<form>
	<label for="forceDifferent">Force different absolute values:</label>
	<select id="forceDifferent" name="forceDifferent" data-role="slider">
		<option value="true">True</option>
		<option value="false">False</option>
	</select>
</form>
<form>
	<label for="selectTimer">Time Limit:</label>
	<select id="selectTimer" name="selectTimer">
		<option value="1000|0.25">1000 (Penalty x 0.25)</option>
		<option value="500|1">500 (No Bonus)</option>
		<option value="100|10">100 (Bonus x 10)</option>
		<option value="50|50">50 (Bonus x 50)</option>
	</select>
</form>
</div><!-- /panel -->

<script>
goal = 55;
timerCount = 0;
startingTimer = 100;
score = 0;
gamesWon = 0;
scoreMultiplier = 1;

gameWon = false;
forceOdds = true;
forceDifferent = true;
	
function newGame(){
	if(gameWon == false){
		gamesWon = 0;
		score = 0;
	}
	gameWon = false;
	
	document.getElementById("displaySuccess").innerHTML = "  <a style='color: green' visibility='false'> </a>";
	negativeMultiplier = -1;
	if(Math.random() >= 0.5){
		negativeMultiplier = 1;
	}
	goal = (Math.floor(Math.random() * 65) + 1) * negativeMultiplier;
	
	inputs = document.getElementsByTagName("input");
	labels = document.getElementsByTagName("label");
	maxSmall = 20;
	maxLarge = 33;
	
	var usedSteps = [];
	i = 0;
	randomStep = getRandomStep(maxSmall, false, usedSteps);
	multiplier = Math.floor(100 / randomStep);
	inputs[i].step = randomStep;
	inputs[i].max = randomStep * multiplier;
	labels[i].innerHTML = "Step of " + randomStep;
	inputs[i].value = 0;
	inputs[i++];
	$("#slider-fill1").slider('refresh');


	
	randomStep = getRandomStep(maxLarge, forceOdds, usedSteps);
	multiplier = Math.floor(100 / randomStep);
	inputs[i].step = randomStep;
	inputs[i].max = randomStep * multiplier;
	labels[i].innerHTML = "Step of " + randomStep;
	inputs[i++].value = 0;
	$("#slider-fill2").slider('refresh');
	
	randomStep = getRandomStep(maxSmall, forceOdds, usedSteps);
	multiplier = Math.floor(100 / randomStep) * -1;
	inputs[i].step = randomStep;
	inputs[i].min = randomStep * multiplier;
	labels[i].innerHTML = "Step of -" + randomStep;
	inputs[i++].value = 0;
	$("#slider-fill3").slider('refresh');
	
	randomStep = getRandomStep(maxLarge, false, usedSteps);
	multiplier = Math.floor(100 / randomStep) * -1;
	inputs[i].step = randomStep;
	inputs[i].min = randomStep * multiplier;
	labels[i].innerHTML = "Step of -" + randomStep;
	inputs[i++].value = 0;
	$("#slider-fill4").slider('refresh');
	
	$("#slider-fill1").slider('enable');
	$("#slider-fill2").slider('enable');
	$("#slider-fill3").slider('enable');
	$("#slider-fill4").slider('enable');
	update();
	timerCount = startingTimer;
}

function getRandomStep(max, isForcedOdd, usedSteps){
	randomStep = Math.floor(Math.random() * max) + 1;
	while(randomStep < 4 || (isForcedOdd && randomStep % 2 == 0) || (forceDifferent && (usedSteps.indexOf(randomStep) > -1) || usedSteps.indexOf(randomStep * -1) > -1)){
		randomStep = Math.floor(Math.random() * max) + 1;
	}
	usedSteps.push(randomStep);
	return randomStep;
}

var mouseDown = false;
document.body.onmousedown = function() { 
  mouseDown = true;
}
document.body.onmouseup = function() {
  mouseDown = false;
  setTimeout(function(){update();}, 500);
}

function update(){
	inputs = document.getElementsByTagName("input");
	count = 0;
	for(i = 0; i < inputs.length; i++){
		if(inputs[i].name != null && inputs[i].name == "slider-fill"){
			count = count + parseInt(inputs[i].value, 10);
		}
	}
	document.getElementById("currentVal").innerHTML = count;
	
	document.getElementById("goal").innerHTML = goal;
	
	if(count == goal && !gameWon && !mouseDown){
		document.getElementById("goal").innerHTML = goal;
		document.getElementById("displaySuccess").innerHTML = "  <a style='color: green'>Goal Achieved!</a>";
		gamesWon++;
		score = score + (timerCount * scoreMultiplier);
		
		
		$("#goal").focus().select();
		$("#slider-fill1").slider('disable');
		$("#slider-fill2").slider('disable');
		$("#slider-fill3").slider('disable');
		$("#slider-fill4").slider('disable');
		//document.getElementById("wonDiv").style.background = "green";
		//alert("You won the game!");
		gameWon = true;
	}
	
	document.getElementById("won").innerHTML = gamesWon;
	
	document.getElementById("score").innerHTML = score;
	//document.getElementById("won").innerHTML = $("#forceOdds").value;
}

$( document ).ready(function() {

 
	$('#forceOdds').on("change", function() {
		forceOdds = $("#forceOdds").val() == 'true';
		newGame();
	});
	
	forceOdds = $("#forceOdds").val() == 'true';
	
	$('#playWith4Sliders').on("change", function() {
		if($("#playWith4Sliders").val() == 'false'){
			$("#slider2").hide();
			$("#slider3").hide();
			$("#forceOdds").slider('disable');
		}
		else{
			$("#slider2").show();
			$("#slider3").show();
			$("#forceOdds").slider('enable')
		}
		newGame();
	});
    
	$('#forceDifferent').on("change", function() {
		forceDifferent = $("#forceDifferent").val() == 'true';
		newGame();
	});
	
	forceDifferent = $("#forceDifferent").val() == 'true';
	
	$('#selectTimer').on("change", function() {
		timerSelectValue = $("#selectTimer").val().split('|');
		startingTimer = parseFloat(timerSelectValue[0]);
		scoreMultiplier = parseFloat(timerSelectValue[1]);
		newGame();
	});
	
	
	timerSelectValue = $("#selectTimer").val().split('|');
	startingTimer = parseFloat(timerSelectValue[0]);
	scoreMultiplier = parseFloat(timerSelectValue[1]);
	
	newGame();

	setInterval(timerDown, 1000);

	timerCount = startingTimer;
	function timerDown() {
		if(!gameWon){
			timerCount--;
		}
		if(timerCount < 0){
			timerCount = 0;
		}
		timer.innerHTML = timerCount;
	}

});




</script>
</body>
</html>